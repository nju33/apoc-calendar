<ul class="apocCalendar-Component_DateTable">
	{{#each $days as day, i}}
		<li
			class="{{getDayCellClass($getDayState(i), $__key_dates__)}}"
			style="{{getDayCellStyle($getDayState(i), $color, $__key_dates__)}}"
			on:click="selectDay(i)"
		>
			<DayCell :day />
		</li>
	{{/each}}

	{{#each $dates as date}}
		<li
			class="{{getDateCellClass(date, $__key_dates__)}}"
			style="{{getDateCellStyle(date, $color, $__key_dates__)}}"
			on:click="selectDate(date)"
			on:mouseenter="handleDateMouseEnter(event)"
			on:mouseleave="handleDateMouseLeave(event)"
		>
			<DateCell :date />
		</li>
	{{/each}}
</ul>

<script>
import throttle from 'lodash.throttle';
import DayCell from './day-cell.html';
import DateCell from './date-cell.html';
import {range} from './helpers';
import DatePad from './date-pad';

export default {
	components: {DayCell, DateCell},
	helpers: {
		getDayCellClass(active) {
			const classnames = ['apocCalendar-Component_DayCell'];

			if (active) {
				classnames.push('apocCalendar-Is_Selected');
			}

			return classnames.join(' ');
		},
		getDayCellStyle(active, color) {
			const styles = [
				`background: ${color.background.cell}`,
				`color: ${color.text}`,
			];

			console.log(active)
			if (active) {
				styles.push(`background: ${color.background.active}`);
			}

			return styles.join(';');
		},
		getDateCellClass(date) {
			const classnames = ['apocCalendar-Component_DateCell'];

			if (date instanceof DatePad) {
				classnames.push('apocCalendar-Is_Pad');
			}

			if (date.isSelected()) {
				classnames.push('apocCalendar-Is_Selected');
			}

			return classnames.join(' ');
		},
		getDateCellStyle(date, color) {
			const styles = [
				`color: ${color.text}`,
			];

			if (!date instanceof DatePad) {
				styles.push(`background: ${color.background.cell}`);
			}

			if (date.isSelected()) {
				styles.push(`background: ${color.background.active}`);
			}


			return styles.join(';')
		}
	},
	methods: {
		selectDay(day) {
			this.store.selectDay(day);
		},
		selectDate(date) {
			if (date instanceof DatePad) {
				return;
			}

			if (date.isSelected()) {
				date.deselect();
			} else {
				date.select();
			}
			this.store.updateDates();
		},
		setActiveColorToBackground(el) {
			Object.assign(el.style, {
				background: this.store.color.background.hover
			});
		},
		resetColorToBackground(el) {
			Object.assign(el.style, {
				background: null
			});
		},
		handleDateMouseEnter(ev) {
			const el = ev.target;
			if (!el.classList.contains('apocCalendar-Is_Selected') && !el.classList.contains('apocCalendar-Is_Pad') ) {
				this.setActiveColorToBackground(el);
			}
		},
		handleDateMouseLeave(ev) {
			const el = ev.target;
			if (!el.classList.contains('apocCalendar-Is_Selected') && !el.classList.contains('apocCalendar-Is_Pad') ) {
				this.resetColorToBackground(el);
			}
		},
	},
}
</script>

<style>
.apocCalendar-Component_DateTable {
	display: grid;
	grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
	grid-auto-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
	grid-gap: 1px;
	list-style: none;
	padding: 0;
	margin: 0;
	user-select: none;
	position: relative;
	z-index: 2;
}

.apocCalendar-Component_DayCell,
.apocCalendar-Component_DateCell {
	/* transition: .1s; */
	font-size: .8em;
	width: 3em;
	height: 1.5em;
	cursor: pointer;
	background: #fff;
	margin: 0;

	/* &.apocCalendar-Is_Selected:not(.apocCalendar-Is_Disabled):not(.apocCalendar-Is_Hidden) {
		background: #cb1b45;
	} */

	/* &:not(.apocCalendar-Is_Prev):not(.apocCalendar-Is_Next):not(.apocCalendar-Is_Disabled):not(.apocCalendar-Is_Selected):not(.apocCalendar-Is_Pad):hover {
		background: #ccc;
	} */
}

.apocCalendar-Is_Pad {
	background: transparent;
}
</style>
