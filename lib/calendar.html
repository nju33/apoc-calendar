<section class="apocCalendar-Component_Box">
	<header class="apocCalendar-Component_Header">{{headText(headTemplate, year, month)}}</header>
	<Month :store :convertDay />
	<Pager :store />
	<Pager :store type="right"/>
</section>

<script>
import pupa from 'pupa';
import CalendarStore from './store'
import Month from './month.html'
import Pager from './pager.html'

const store = new CalendarStore();
if (process.env.NODE_ENV !== 'production') {
	window.store = store;
}

export default {
	components: {
		Month,
		Pager,
	},
	data() {
		return {
			store,
			headTemplate: '{year}.{month}',
			convertDay: day => {
				switch (day) {
					case 0: {
						return '日';
					}
					case 1: {
						return '月';
					}
					case 2: {
						return '火';
					}
					case 3: {
						return '水';
					}
					case 4: {
						return '木';
					}
					case 5: {
						return '金';
					}
					case 6: {
						return '土';
					}
					default: {
						throw new Error('err');
					}
				}
			},
		};
	},
	helpers: {
		headText(template, year, month) {
			return pupa(template, {
				year: year,
				month: month + 1,
			});
		},
	},
	methods: {
		reset() {
			store.reset();
		}
	},
	oncreate() {
		store.observe('year', year => {
			this.set({year});
		});

		store.observe('month', month => {
			this.set({month});
		});

		const handleChange = () => {
			const data = store.exportData();
			if (data.length === 0) {
				return;
			}
			this.fire('change', {data});
		}

		store.observe('currentDates', handleChange);
		store.observe('data', handleChange);
	}
};
</script>

<style>
.apocCalendar-Component_Box {
	position: relative;
	font-size: 1em;
	/* padding: 0 2em; */
	box-sizing: border-box;
	background: #444;
	border: 1px solid #444;
}

.apocCalendar-Component_Header {
	font-size: 1.2em;
	font-weight: bold;
	line-height: 4;
	margin-bottom: 1px;
	background: #fff;
	user-select: none;
}
</style>
